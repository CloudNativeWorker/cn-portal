(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7bba3126"],{"07ac":function(t,e,s){"use strict";var i=s("23e7"),a=s("6f53").values;i({target:"Object",stat:!0},{values:function(t){return a(t)}})},"1c8e":function(t,e,s){"use strict";s("99af"),s("e9c4"),s("d3b7");var i=s("cee4"),a=s("d445"),n=s("3136"),o=s("5cc6"),r={props:{options:{type:Object,default:{}}},data:function(){return{progress:new a["a"]({color:"var(--progress-bar)"}),overrideProxyChoice:!1,overrideUpdateInterval:null,disableLoader:!1,updater:null,defaultTimeout:5e4}},mounted:function(){this.fetchData(),this.updateInterval&&(this.continuousUpdates(),this.disableLoader=!0)},beforeDestroy:function(){this.updater&&clearInterval(this.updater)},computed:{proxyReqEndpoint:function(){var t=Object({NODE_ENV:"production",VUE_APP_VERSION:"2.1.2",BASE_URL:"/"}).VUE_APP_DOMAIN||window.location.origin;return"".concat(t).concat(o["serviceEndpoints"].corsProxy)},useProxy:function(){return this.options.useProxy||this.overrideProxyChoice},updateInterval:function(){var t=this.options.updateInterval;return null===t&&this.overrideUpdateInterval?1e3*this.overrideUpdateInterval:t?"boolean"===typeof t?3e4:"number"===typeof t&&t>=2&&t<=7200?1e3*t:0:0}},methods:{update:function(){this.startLoading(),this.fetchData()},continuousUpdates:function(){var t=this;this.updater=setInterval((function(){t.update()}),this.updateInterval)},error:function(t,e){Object(n["e"])(t,e),this.options.ignoreErrors||this.$emit("error",t)},startLoading:function(){this.disableLoader||(this.$emit("loading",!0),this.progress.start())},finishLoading:function(){var t=this;this.$emit("loading",!1),setTimeout((function(){t.progress.end()}),500)},fetchData:function(){this.finishLoading()},tooltip:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{content:t,html:e,trigger:"hover focus",delay:250}},makeRequest:function(t,e,s,a){var n=this,o=s||"GET",r=this.useProxy?this.proxyReqEndpoint:t,c=JSON.stringify(a||{}),u=e||null,l=this.useProxy?{"Target-URL":t,CustomHeaders:JSON.stringify(u)}:u,d=this.options.timeout||this.defaultTimeout,h={method:o,url:r,headers:l,data:c,timeout:d};return new Promise((function(t,e){i["a"].request(h).then((function(e){!1===e.data.success&&n.error("Proxy returned error from target server",e.data.message),t(e.data)})).catch((function(t){n.error("Unable to fetch data",t),e(t)})).finally((function(){n.finishLoading()}))}))}}};e["a"]=r},2937:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nextcloud-widget nextcloud-user-status-wrapper"},[t.didLoadData?e("div",{staticClass:"sep"},t._l(t.statuses,(function(s,i){return e("div",{key:i,staticClass:"user"},[e("div",[e("div",[e("i",[t._v(t._s(s.icon))])]),e("div",[e("p",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.clearAtTooltip(s.clearAt),expression:"clearAtTooltip(status.clearAt)"}]},[e("strong",[t._v(t._s(s.userId))]),t._v("  "),s.clearAt?e("small",[e("i",{staticClass:"fal fa-clock"})]):s.message?e("span",[t._v("•")]):t._e(),e("em",[t._v(t._s(s.message))])])]),e("div",[e("p",[e("small",{class:"status ".concat(s.status)},["online"===s.status||"dnd"===s.status?e("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.tt(s.status),expression:"tt(status.status)"}],staticClass:"fas fa-circle"}):e("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.tt(s.status),expression:"tt(status.status)"}],staticClass:"far fa-circle"})])])])]),e("hr")])})),0):e("div",{staticClass:"sep"},[e("p",[t._v(t._s(t.tt("nothing-to-show")))])])])},a=[],n=s("c7eb"),o=s("1da1"),r=(s("99af"),s("caad"),s("14d9"),s("fb6a"),s("b64b"),s("d3b7"),s("07ac"),s("2532"),s("3ca3"),s("159b"),s("ddb0"),s("1c8e")),c=s("2c3a"),u={allAtOnce:"AllAtOnce",oneByOne:"OneByOne"},l={mixins:[r["a"],c["a"]],components:{},computed:{didLoadData:function(){return!!Object.keys((null===this||void 0===this?void 0:this.statuses)||{}).length},fetchStrategy:function(){return this.options.fetchStrategy&&Object.values(u).includes(this.options.fetchStrategy)?this.options.fetchStrategy:u.allAtOnce},users:function(){return this.options.users&&Array.isArray(this.options.users)?this.options.users.length>100?this.options.users.slice(0,100):this.options.users:[]},showEmpty:function(){return!!this.options.showEmpty}},data:function(){return{statuses:{}}},methods:{allowedStatuscodes:function(){return[100,200]},fetchData:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var s,i;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.hasValidCredentials()&&t.users.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.loadCapabilities();case 4:if(null!==(s=t.capabilities)&&void 0!==s&&s.userStatus){e.next=7;break}return t.error("This Nextcloud server doesn't support the User Status API"),e.abrupt("return");case 7:t.fetchStrategy===u.allAtOnce?t.makeRequest(t.endpoint("userstatus"),t.headers).then(t.processStatuses).finally(t.finishLoading):(i=[],t.newStatuses={},t.users.forEach((function(e){i.push(t.makeRequest("".concat(t.endpoint("userstatus"),"/").concat(e),t.headers).then(t.processStatus))})),Promise.all(i).then((function(){t.statuses=t.newStatuses,delete t.newStatuses})).finally(t.finishLoading));case 8:case"end":return e.stop()}}),e)})))()},processStatuses:function(t){var e=this,s=this.validateResponse(t),i={};Object.values(s).forEach((function(t){e.users.includes(t.userId)&&(t.message||e.showEmpty)&&(i[t.userId]=t)})),this.statuses=i},processStatus:function(t){var e=this.validateResponse(t),s=Array.isArray(e)&&e.length?e[0]:e;s&&(s.message||this.showEmpty)&&(this.newStatuses[s.userId]=s)},clearAtTooltip:function(t){var e=t?"".concat(this.tt("until"))+" ".concat(new Date(1e3*t).toLocaleString()):"";return{content:e,html:!0,trigger:"hover focus",delay:250,classes:"nc-tooltip"}}},created:function(){this.overrideUpdateInterval=60}},d=l,h=(s("c91d"),s("2877")),p=Object(h["a"])(d,i,a,!1,null,"3edd61d2",null);e["default"]=p.exports},"2c3a":function(t,e,s){"use strict";var i=s("3835"),a=(s("99af"),s("caad"),s("d81d"),s("b680"),s("d3b7"),s("ac1f"),s("00b4"),s("25f0"),s("2532"),s("466d"),s("498a"),s("313d"),s("0eb6"),s("b7ef"),s("8bd4"),s("5cc6")),n=s("b96f");e["a"]={data:function(){return{validCredentials:null,capabilities:{notifications:{enabled:null,features:[]},userStatus:null},capabilitiesLastUpdated:0,branding:{name:null,logo:null,url:null,slogan:null},version:{string:null,edition:null}}},computed:{hostname:function(){return this.options.hostname||this.error("A hostname is required"),this.options.hostname},username:function(){return this.options.username||this.error("A username is required"),this.options.username},password:function(){return this.options.password||this.error("An app-password is required"),/^([a-z0-9]{5}-){4}[a-z0-9]{5}$/i.test(this.options.password)?this.options.password:(this.error("Please use a Nextcloud app-password, not your login password."),"")},headers:function(){var t="".concat(this.username,":").concat(this.password);return{"OCS-APIREQUEST":!0,Accept:"application/json",Authorization:"Basic ".concat(window.btoa(t))}},capabilitiesTtl:function(){return 1e3*(parseInt(this.options.capabilitiesTtl,10)||3600)},proxyReqEndpoint:function(){var t=Object({NODE_ENV:"production",VUE_APP_VERSION:"2.1.2",BASE_URL:"/"}).VUE_APP_DOMAIN||window.location.origin;return"".concat(t).concat(a["serviceEndpoints"].corsProxy)}},methods:{endpoint:function(t){switch(t){case"user":return"".concat(this.hostname,"/ocs/v1.php/cloud/users/").concat(this.username);case"userstatus":return"".concat(this.hostname,"/ocs/v2.php/apps/user_status/api/v1/statuses");case"serverinfo":return"".concat(this.hostname,"/ocs/v2.php/apps/serverinfo/api/v1/info");case"notifications":return"".concat(this.hostname,"/ocs/v2.php/apps/notifications/api/v2/notifications");case"capabilities":default:return"".concat(this.hostname,"/ocs/v1.php/cloud/capabilities")}},hasValidCredentials:function(){return!1!==this.validCredentials&&this.username.length>0&&this.password.length>0},validateResponse:function(t){var e,s,i=null===t||void 0===t||null===(e=t.ocs)||void 0===e?void 0:e.data,a=null===t||void 0===t||null===(s=t.ocs)||void 0===s?void 0:s.meta,n=null===t||void 0===t?void 0:t.error;switch(n&&n.status&&(a={statuscode:n.status}),a&&a.statuscode&&i||this.error("Invalid response"),a.statuscode){case 401:this.validCredentials=!1,this.error("Access denied for user ".concat(this.username,".")+" Note that some Nextcloud widgets only work with an admin user.");break;case 429:this.validCredentials=!1,this.error("The server indicated 'rate-limit reached' error (HTTP 429). The server-info API may return this error for incorrect user/password.");break;case 993:case 997:case 998:this.validCredentials=!1,this.error("The provided app-password is not permitted to access the requested resource or it has been revoked, or the username/password combination is incorrect");break;default:this.validCredentials=!0,this.allowedStatuscodes().includes(a.statuscode)||this.error("Unexpected response");break}return i},loadCapabilities:function(){return(new Date).getTime()-this.capabilitiesLastUpdated>this.capabilitiesTtl?this.makeRequest(this.endpoint("capabilities"),this.headers).then(this.processCapabilities):Promise.resolve()},processCapabilities:function(t){var e,s,i,a,n,o=this.validateResponse(t),r=null===(e=o.capabilities)||void 0===e||null===(e=e.notifications)||void 0===e?void 0:e["ocs-endpoints"];this.branding=null===(s=o.capabilities)||void 0===s?void 0:s.theming,this.capabilities.notifications.enabled=!(null===r||void 0===r||!r.length),this.capabilities.notifications.features=r||[],this.capabilities.userStatus=!(null===(i=o.capabilities)||void 0===i||null===(i=i.user_status)||void 0===i||!i.enabled),this.version.string=null===(a=o.version)||void 0===a?void 0:a.string,this.version.edition=null===(n=o.version)||void 0===n?void 0:n.edition,this.capabilitiesLastUpdated=(new Date).getTime()},getTimeAgo:function(t){return Object(n["l"])(t)},formatDateTime:function(t){return Object(n["s"])(t)},convertBytes:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object(n["d"])(t,e).toString();if(!s)return i;var a=i.match(/(-?\d+)((\.\d+)?\s(([KMGTPEZY]B|Bytes)))/);return"".concat(a[1],'<span class="decimals">').concat(a[2],"</span>")},formatNumber:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object(n["g"])(t,e).toString();if(!s)return i;var a=i.match(/(\d+)((\.\d+)?([KMBT]?))/);return"".concat(a[1],'<span class="decimals">').concat(a[2],"</span>")},formatPercent:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=parseFloat(t).toFixed(e).split("."),i=s.length>1?".".concat(s[1]):"";return"".concat(s[0],'<span class="decimals">').concat(i,"%</span>")},getValueFromCss:function(t){var e=getComputedStyle(this.$el||document.documentElement);return e.getPropertyValue("--".concat(t)).trim()},getColorRgba:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=this.getValueFromCss(t).match(/\w\w/g).map((function(t){return parseInt(t,16)})),a=Object(i["a"])(s,3),n=a[0],o=a[1],r=a[2];return"rgba(".concat(n,",").concat(o,",").concat(r,",").concat(e,")")},tt:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.$t("widgets.nextcloud.".concat(t),e)}}}},"31ee":function(t,e,s){},c91d:function(t,e,s){"use strict";s("31ee")}}]);
//# sourceMappingURL=chunk-7bba3126.e2ed5fba.js.map