(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a79e1bb"],{"1c8e":function(t,e,i){"use strict";i("99af"),i("e9c4"),i("d3b7");var n=i("cee4"),a=i("d445"),o=i("3136"),s=i("5cc6"),r={props:{options:{type:Object,default:{}}},data:function(){return{progress:new a["a"]({color:"var(--progress-bar)"}),overrideProxyChoice:!1,overrideUpdateInterval:null,disableLoader:!1,updater:null,defaultTimeout:5e4}},mounted:function(){this.fetchData(),this.updateInterval&&(this.continuousUpdates(),this.disableLoader=!0)},beforeDestroy:function(){this.updater&&clearInterval(this.updater)},computed:{proxyReqEndpoint:function(){var t=Object({NODE_ENV:"production",VUE_APP_VERSION:"2.1.2",BASE_URL:"/"}).VUE_APP_DOMAIN||window.location.origin;return"".concat(t).concat(s["serviceEndpoints"].corsProxy)},useProxy:function(){return this.options.useProxy||this.overrideProxyChoice},updateInterval:function(){var t=this.options.updateInterval;return null===t&&this.overrideUpdateInterval?1e3*this.overrideUpdateInterval:t?"boolean"===typeof t?3e4:"number"===typeof t&&t>=2&&t<=7200?1e3*t:0:0}},methods:{update:function(){this.startLoading(),this.fetchData()},continuousUpdates:function(){var t=this;this.updater=setInterval((function(){t.update()}),this.updateInterval)},error:function(t,e){Object(o["e"])(t,e),this.options.ignoreErrors||this.$emit("error",t)},startLoading:function(){this.disableLoader||(this.$emit("loading",!0),this.progress.start())},finishLoading:function(){var t=this;this.$emit("loading",!1),setTimeout((function(){t.progress.end()}),500)},fetchData:function(){this.finishLoading()},tooltip:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{content:t,html:e,trigger:"hover focus",delay:250}},makeRequest:function(t,e,i,a){var o=this,s=i||"GET",r=this.useProxy?this.proxyReqEndpoint:t,c=JSON.stringify(a||{}),u=e||null,l=this.useProxy?{"Target-URL":t,CustomHeaders:JSON.stringify(u)}:u,d=this.options.timeout||this.defaultTimeout,p={method:s,url:r,headers:l,data:c,timeout:d};return new Promise((function(t,e){n["a"].request(p).then((function(e){!1===e.data.success&&o.error("Proxy returned error from target server",e.data.message),t(e.data)})).catch((function(t){o.error("Unable to fetch data",t),e(t)})).finally((function(){o.finishLoading()}))}))}}};e["a"]=r},"2c3a":function(t,e,i){"use strict";var n=i("3835"),a=(i("99af"),i("caad"),i("d81d"),i("b680"),i("d3b7"),i("ac1f"),i("00b4"),i("25f0"),i("2532"),i("466d"),i("498a"),i("313d"),i("0eb6"),i("b7ef"),i("8bd4"),i("5cc6")),o=i("b96f");e["a"]={data:function(){return{validCredentials:null,capabilities:{notifications:{enabled:null,features:[]},userStatus:null},capabilitiesLastUpdated:0,branding:{name:null,logo:null,url:null,slogan:null},version:{string:null,edition:null}}},computed:{hostname:function(){return this.options.hostname||this.error("A hostname is required"),this.options.hostname},username:function(){return this.options.username||this.error("A username is required"),this.options.username},password:function(){return this.options.password||this.error("An app-password is required"),/^([a-z0-9]{5}-){4}[a-z0-9]{5}$/i.test(this.options.password)?this.options.password:(this.error("Please use a Nextcloud app-password, not your login password."),"")},headers:function(){var t="".concat(this.username,":").concat(this.password);return{"OCS-APIREQUEST":!0,Accept:"application/json",Authorization:"Basic ".concat(window.btoa(t))}},capabilitiesTtl:function(){return 1e3*(parseInt(this.options.capabilitiesTtl,10)||3600)},proxyReqEndpoint:function(){var t=Object({NODE_ENV:"production",VUE_APP_VERSION:"2.1.2",BASE_URL:"/"}).VUE_APP_DOMAIN||window.location.origin;return"".concat(t).concat(a["serviceEndpoints"].corsProxy)}},methods:{endpoint:function(t){switch(t){case"user":return"".concat(this.hostname,"/ocs/v1.php/cloud/users/").concat(this.username);case"userstatus":return"".concat(this.hostname,"/ocs/v2.php/apps/user_status/api/v1/statuses");case"serverinfo":return"".concat(this.hostname,"/ocs/v2.php/apps/serverinfo/api/v1/info");case"notifications":return"".concat(this.hostname,"/ocs/v2.php/apps/notifications/api/v2/notifications");case"capabilities":default:return"".concat(this.hostname,"/ocs/v1.php/cloud/capabilities")}},hasValidCredentials:function(){return!1!==this.validCredentials&&this.username.length>0&&this.password.length>0},validateResponse:function(t){var e,i,n=null===t||void 0===t||null===(e=t.ocs)||void 0===e?void 0:e.data,a=null===t||void 0===t||null===(i=t.ocs)||void 0===i?void 0:i.meta,o=null===t||void 0===t?void 0:t.error;switch(o&&o.status&&(a={statuscode:o.status}),a&&a.statuscode&&n||this.error("Invalid response"),a.statuscode){case 401:this.validCredentials=!1,this.error("Access denied for user ".concat(this.username,".")+" Note that some Nextcloud widgets only work with an admin user.");break;case 429:this.validCredentials=!1,this.error("The server indicated 'rate-limit reached' error (HTTP 429). The server-info API may return this error for incorrect user/password.");break;case 993:case 997:case 998:this.validCredentials=!1,this.error("The provided app-password is not permitted to access the requested resource or it has been revoked, or the username/password combination is incorrect");break;default:this.validCredentials=!0,this.allowedStatuscodes().includes(a.statuscode)||this.error("Unexpected response");break}return n},loadCapabilities:function(){return(new Date).getTime()-this.capabilitiesLastUpdated>this.capabilitiesTtl?this.makeRequest(this.endpoint("capabilities"),this.headers).then(this.processCapabilities):Promise.resolve()},processCapabilities:function(t){var e,i,n,a,o,s=this.validateResponse(t),r=null===(e=s.capabilities)||void 0===e||null===(e=e.notifications)||void 0===e?void 0:e["ocs-endpoints"];this.branding=null===(i=s.capabilities)||void 0===i?void 0:i.theming,this.capabilities.notifications.enabled=!(null===r||void 0===r||!r.length),this.capabilities.notifications.features=r||[],this.capabilities.userStatus=!(null===(n=s.capabilities)||void 0===n||null===(n=n.user_status)||void 0===n||!n.enabled),this.version.string=null===(a=s.version)||void 0===a?void 0:a.string,this.version.edition=null===(o=s.version)||void 0===o?void 0:o.edition,this.capabilitiesLastUpdated=(new Date).getTime()},getTimeAgo:function(t){return Object(o["l"])(t)},formatDateTime:function(t){return Object(o["s"])(t)},convertBytes:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=Object(o["d"])(t,e).toString();if(!i)return n;var a=n.match(/(-?\d+)((\.\d+)?\s(([KMGTPEZY]B|Bytes)))/);return"".concat(a[1],'<span class="decimals">').concat(a[2],"</span>")},formatNumber:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=Object(o["g"])(t,e).toString();if(!i)return n;var a=n.match(/(\d+)((\.\d+)?([KMBT]?))/);return"".concat(a[1],'<span class="decimals">').concat(a[2],"</span>")},formatPercent:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=parseFloat(t).toFixed(e).split("."),n=i.length>1?".".concat(i[1]):"";return"".concat(i[0],'<span class="decimals">').concat(n,"%</span>")},getValueFromCss:function(t){var e=getComputedStyle(this.$el||document.documentElement);return e.getPropertyValue("--".concat(t)).trim()},getColorRgba:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.getValueFromCss(t).match(/\w\w/g).map((function(t){return parseInt(t,16)})),a=Object(n["a"])(i,3),o=a[0],s=a[1],r=a[2];return"rgba(".concat(o,",").concat(s,",").concat(r,",").concat(e,")")},tt:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.$t("widgets.nextcloud.".concat(t),e)}}}},"7eda":function(t,e,i){},"857a":function(t,e,i){"use strict";var n=i("e330"),a=i("1d80"),o=i("577e"),s=/"/g,r=n("".replace);t.exports=function(t,e,i,n){var c=o(a(t)),u="<"+e;return""!==i&&(u+=" "+i+'="'+r(o(n),s,"&quot;")+'"'),u+">"+c+"</"+e+">"}},9911:function(t,e,i){"use strict";var n=i("23e7"),a=i("857a"),o=i("af03");n({target:"String",proto:!0,forced:o("link")},{link:function(t){return a(this,"a","href",t)}})},af03:function(t,e,i){"use strict";var n=i("d039");t.exports=function(t){return n((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},e7c1:function(t,e,i){"use strict";i("7eda")},f48c:function(t,e,i){"use strict";i.r(e);i("9911");var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nextcloud-widget nextcloud-status-wrapper"},[t.notifications.length?e("div",[t.canDeleteNotification("delete-all")?e("p",{staticClass:"group-action"},[e("span",{staticClass:"action secondary",on:{click:t.deleteNotifications}},[t._v(t._s(t.tt("delete-all")))])]):t._e(),e("hr"),t._l(t.notifications,(function(i,n){return e("div",{key:n,staticClass:"notification"},[e("div",[e("img",{attrs:{src:t.notificationIcon(i.icon)}})]),e("div",[e("p",[e("small",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.dateTooltip(i),expression:"dateTooltip(notification)"}],staticClass:"date"},[t._v(" "+t._s(t.getTimeAgo(Date.parse(i.datetime)))+" ")]),t._v(" "),e("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.subjectTooltip(i),expression:"subjectTooltip(notification)"}]},[t._v(t._s(i.subject)+" ")]),i.actions.length?e("span",t._l(i.actions,(function(i,n){return e("span",{key:n},[e("a",{staticClass:"action",attrs:{href:i.link,target:"_blank"}},[t._v(t._s(i.label))])])})),0):t._e(),t.canDeleteNotification("delete")?e("span",[e("a",{staticClass:"action secondary",on:{click:function(e){return t.deleteNotification(i.notification_id)}}},[t._v(t._s(t.tt("delete-notification")))])]):t._e()])]),e("hr")])}))],2):e("div",{staticClass:"sep"},[e("p",[t._v(t._s(t.tt("no-notifications")))])])])},a=[],o=i("3835"),s=i("c7eb"),r=i("1da1"),c=(i("99af"),i("caad"),i("14d9"),i("d3b7"),i("ac1f"),i("2532"),i("466d"),i("5319"),i("159b"),i("1c8e")),u=i("2c3a"),l={mixins:[c["a"],u["a"]],components:{},data:function(){return{notifications:[]}},computed:{limit:function(){var t=this.options.limit,e=[0,!1];if("string"===typeof t){var i={m:60,h:3600,d:86400},n=t.match(/(\d+)([hmd])/);return 3!==n.length?e:[!1,n[1]*i[n[2]]*1e3]}return"number"===typeof t?[parseInt(this.options.limit,10)||0,!1]:e}},methods:{allowedStatuscodes:function(){return[100,200]},fetchData:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.hasValidCredentials()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.loadCapabilities();case 4:if(null!==(i=t.capabilities)&&void 0!==i&&null!==(i=i.notifications)&&void 0!==i&&i.enabled){e.next=7;break}return t.error("This Nextcloud server doesn't support the Notifications API"),e.abrupt("return");case 7:t.makeRequest(t.endpoint("notifications"),t.headers).then(t.processNotifications).finally(t.finishLoading);case 8:case"end":return e.stop()}}),e)})))()},processNotifications:function(t){var e=this,i=this.validateResponse(t),n=Object(o["a"])(this.limit,2),a=n[0],s=n[1];this.notifications=[],i.forEach((function(t){if(!a||e.notifications.length!==a){var i=Date.parse(t.datetime),n=(new Date).getTime();s&&i&&n-i>s||e.notifications.push(t)}}))},notificationIcon:function(t){var e=this.getValueFromCss("widget-text-color").replace("#","");return t.replace("core/img","svg/core").replace(/extra-apps\/([^/]+)\/img/,"svg/$1").replace(/apps\/([^/]+)\/img/,"svg/$1").replace(".svg","?color=".concat(e))},canDeleteNotification:function(t){var e,i=null===(e=this.capabilities)||void 0===e||null===(e=e.notifications)||void 0===e?void 0:e.features;return Array.isArray(i)&&i.includes(t)},deleteNotifications:function(){var t=this;this.makeRequest(this.endpoint("notifications"),this.headers,"DELETE").then((function(){t.notifications=[]}))},deleteNotification:function(t){this.makeRequest("".concat(this.endpoint("notifications"),"/").concat(t),this.headers,"DELETE").then(this.fetchData)},subjectTooltip:function(t){var e=t.message;return{content:e,trigger:"hover focus",delay:250,classes:"nc-tooltip"}},dateTooltip:function(t){var e=new Date(Date.parse(t.datetime)).toLocaleString();return{content:e,trigger:"hover focus",delay:250,classes:"nc-tooltip"}}},created:function(){this.overrideUpdateInterval=60}},d=l,p=(i("e7c1"),i("2877")),h=Object(p["a"])(d,n,a,!1,null,"1fe3484f",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-7a79e1bb.5dc8c73c.js.map